import{J as P,r as I,x as M,j as e,Q as G,t as A,S as K}from"./app-DRrHojaG.js";import{C as u}from"./CustomInput-DV5YoaUn.js";import{B as x}from"./button-BuJzaNID.js";import{C as j,a as f,b as g,F as D,d as b,c as v}from"./card-DOr82eaN.js";import{S as U}from"./separator-C-4gOJsk.js";import{I as O}from"./input-CjzGAmC8.js";import{L as N}from"./label-CUFgRLfr.js";import{S as E,a as L,b as R,c as B,d as h,T as W}from"./index-C4dMKRre.js";import{A as X}from"./app-layout-jSz2uPLn.js";import{C as Y,a as Z}from"./CustomtextArea-s-14ojIi.js";import{C as ee}from"./Custommodal-Bijt5Y-c.js";import{u as se}from"./useTranslation-DZairWB1.js";import{B as ae}from"./building-BQtN6JYq.js";import{P as te}from"./package-C4hIybyN.js";import{T as re}from"./trash-2-CIaX_W2K.js";import{P as le}from"./plus-B7cQxdFq.js";import{L as ie}from"./loader-circle-DSYYfm_9.js";import{S as ne}from"./save-DaJ3FWZK.js";/* empty css            */import"./index-C8Gpbpq8.js";import"./index-DDCA5pFv.js";import"./index-BDIKmkXC.js";import"./app-logo-icon-B5qPAw4t.js";import"./circle-check-big-DJ0PYvcw.js";function Je(){var J;const{purchase:r}=P().props,{t:s}=se(),[d,_]=I.useState(r.items||[]),[C,V]=I.useState(r.vat_rate||15),S=I.useRef(null),{errors:T}=P().props,$=[{title:s("purchases"),href:"/purchases"},{title:s("edit-purchase"),href:`/purchases/${r.id}/edit`}],{data:l,setData:n,processing:q,errors:c}=M({purchase_number:r.purchase_number||"",supplier_name:r.supplier_name||"",supplier_company:r.supplier_company||"",supplier_phone:r.supplier_phone||"",supplier_email:r.supplier_email||"",supplier_address:r.supplier_address||"",items:JSON.stringify(r.items||[]),subtotal:r.subtotal||0,vat_rate:r.vat_rate||15,vat_amount:r.vat_amount||0,total:r.total||0,purchase_date:r.purchase_date||new Date().toISOString().split("T")[0],status:r.status||"pending",notes:r.notes||""}),k=()=>{const a={id:Date.now().toString(),description:"",quantity:1,unit_price:0,total:0},t=[...d,a];_(t),n("items",JSON.stringify(t))},Q=a=>{if(d.length>1){const t=d.filter(i=>i.id!==a);_(t),n("items",JSON.stringify(t)),F(t)}},w=(a,t,i)=>{const m=d.map(o=>{if(o.id===a){const p={...o,[t]:i};return(t==="quantity"||t==="unit_price")&&(p.total=p.quantity*p.unit_price),p}return o});_(m),n("items",JSON.stringify(m)),F(m)},F=a=>{const t=a.reduce((o,p)=>o+p.total,0),i=t*C/100,m=t+i;n(o=>({...o,subtotal:t,vat_amount:i,total:m,vat_rate:C}))},z=a=>{V(a);const t=d.reduce((o,p)=>o+p.total,0),i=t*a/100,m=t+i;n(o=>({...o,subtotal:t,vat_amount:i,total:m,vat_rate:a}))},H=a=>{a.preventDefault(),console.log("Form data before submit:",l),console.log("Items before JSON conversion:",d),K.put(W("purchases.update",r.id),{...l,items:JSON.stringify(d),vat_amount:l.vat_amount||0},{preserveScroll:!0,preserveState:!1,onSuccess:()=>{console.log("Purchase updated successfully!"),S.current&&S.current.showModal()},onError:t=>{console.error("Validation errors:",t)}})},y=a=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(a);return e.jsxs(X,{breadcrumbs:$,children:[e.jsx(G,{title:s("edit-purchase")}),e.jsxs("div",{className:"space-y-6 p-6",children:[(Object.keys(c).length>0||Object.keys(T||{}).length>0)&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-medium mb-2",children:s("validation-errors")}),e.jsxs("ul",{className:"text-red-700 text-sm space-y-1",children:[Object.entries(c).map(([a,t])=>e.jsxs("li",{children:["• ",a,": ",t]},a)),Object.entries(T||{}).map(([a,t])=>e.jsxs("li",{children:["• ",a,": ",String(t)]},`page-${a}`))]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 arabic-font",children:s("edit-purchase")}),e.jsx("p",{className:"text-gray-600 mt-1 arabic-font",children:s("edit-purchase-description")})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(A,{href:`/purchases/${r.id}`,children:e.jsx(x,{variant:"outline",className:"arabic-font",children:s("cancel")})})})]}),e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(D,{className:"h-5 w-5"}),s("purchase-information")]}),e.jsx(b,{className:"arabic-font",children:s("enter-basic-purchase-details")})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{label:s("purchase-number"),type:"text",placeholder:s("enter-purchase-number"),value:l.purchase_number,onChange:a=>n("purchase_number",a.target.value),error:c.purchase_number}),e.jsx(u,{label:s("purchase-date"),type:"date",value:l.purchase_date,onChange:a=>n("purchase_date",a.target.value),error:c.purchase_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"arabic-font",children:s("order-status")}),e.jsxs(E,{value:(J=l.status)==null?void 0:J.toString(),onValueChange:a=>n("status",a),children:[e.jsx(L,{children:e.jsx(R,{placeholder:s("select-purchase-status")})}),e.jsxs(B,{children:[e.jsx(h,{value:"pending",children:s("pending")}),e.jsx(h,{value:"completed",children:s("completed")}),e.jsx(h,{value:"cancelled",children:s("cancelled")})]})]}),c.status&&e.jsx("p",{className:"text-red-600 text-xs",children:c.status})]})]})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(ae,{className:"h-5 w-5"}),s("supplier-information")]}),e.jsx(b,{className:"arabic-font",children:s("enter-supplier-contact-details")})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{label:s("supplier-name"),type:"text",placeholder:s("enter-supplier-name"),value:l.supplier_name,onChange:a=>n("supplier_name",a.target.value),error:c.supplier_name}),e.jsx(u,{label:s("supplier-company"),type:"text",placeholder:s("enter-supplier-company"),value:l.supplier_company,onChange:a=>n("supplier_company",a.target.value),error:c.supplier_company})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{label:s("supplier-phone"),type:"text",placeholder:s("enter-supplier-phone"),value:l.supplier_phone,onChange:a=>n("supplier_phone",a.target.value),error:c.supplier_phone}),e.jsx(u,{label:s("supplier-email"),type:"email",placeholder:s("enter-supplier-email"),value:l.supplier_email,onChange:a=>n("supplier_email",a.target.value),error:c.supplier_email})]}),e.jsx(u,{label:s("supplier-address"),type:"text",placeholder:s("enter-supplier-address"),value:l.supplier_address,onChange:a=>n("supplier_address",a.target.value),error:c.supplier_address})]})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(te,{className:"h-5 w-5"}),s("order-items")]}),e.jsx(b,{className:"arabic-font",children:s("add-items-to-purchase-order")})]}),e.jsxs(v,{className:"space-y-4",children:[d.map((a,t)=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium arabic-font",children:[s("item")," ",t+1]}),d.length>1&&e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:()=>Q(a.id),className:"text-red-600 hover:text-red-700 arabic-font",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),s("remove-item")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(N,{className:"arabic-font",children:s("item-description")}),e.jsx(O,{placeholder:s("enter-description"),value:a.description,onChange:i=>w(a.id,"description",i.target.value)})]}),e.jsxs("div",{children:[e.jsx(N,{className:"arabic-font",children:s("quantity")}),e.jsx(O,{type:"number",placeholder:s("enter-quantity"),value:a.quantity,onChange:i=>w(a.id,"quantity",parseInt(i.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(N,{className:"arabic-font",children:s("unit-price")}),e.jsx(O,{type:"number",step:"0.01",placeholder:s("enter-unit-price"),value:a.unit_price,onChange:i=>w(a.id,"unit_price",parseFloat(i.target.value)||0)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx(N,{className:"text-sm text-gray-600 arabic-font",children:s("item-total")}),e.jsx("div",{className:"text-lg font-semibold",children:y(a.total)})]})})]},a.id)),e.jsxs(x,{type:"button",variant:"outline",onClick:k,className:"w-full arabic-font",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),s("add-item")]})]})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(Y,{className:"h-5 w-5"}),s("pricing-summary")]}),e.jsx(b,{className:"arabic-font",children:s("review-pricing-calculations")})]}),e.jsx(v,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"arabic-font",children:s("purchase-subtotal")}),e.jsx("span",{className:"font-semibold",children:y(l.subtotal||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"arabic-font",children:s("vat-rate")}),e.jsxs(E,{value:C.toString(),onValueChange:a=>z(parseInt(a)),children:[e.jsx(L,{className:"w-24",children:e.jsx(R,{})}),e.jsxs(B,{children:[e.jsx(h,{value:"0",children:"0%"}),e.jsx(h,{value:"5",children:"5%"}),e.jsx(h,{value:"15",children:"15%"}),e.jsx(h,{value:"20",children:"20%"})]})]})]}),e.jsx("span",{className:"font-semibold",children:y(l.vat_amount||0)})]}),e.jsx(U,{}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{className:"arabic-font",children:s("final-total")}),e.jsx("span",{children:y(l.total||0)})]})]})})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(D,{className:"h-5 w-5"}),s("notes")]}),e.jsx(b,{className:"arabic-font",children:s("additional-purchase-notes")})]}),e.jsx(v,{children:e.jsx(Z,{label:s("notes"),value:l.notes,onChange:a=>n("notes",a.target.value),error:c.notes})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6",children:[e.jsx(A,{href:`/purchases/${r.id}`,children:e.jsx(x,{type:"button",variant:"outline",className:"arabic-font",children:s("cancel")})}),e.jsx(x,{type:"submit",disabled:q,className:"arabic-font",children:q?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2 animate-spin"}),s("processing")]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),s("update-purchase")]})})]})]}),e.jsx(ee,{modalname:S,message:s("purchase-updated-successfully")})]})]})}export{Je as default};
