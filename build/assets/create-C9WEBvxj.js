import{r as q,J as Q,x as z,j as e,Q as H,t as F,S as M}from"./app-DRrHojaG.js";import{C as o}from"./CustomInput-DV5YoaUn.js";import{B as m}from"./button-BuJzaNID.js";import{C as u,a as h,b as x,F as O,d as j,c as f}from"./card-DOr82eaN.js";import{S as $}from"./separator-C-4gOJsk.js";import{I as C}from"./input-CjzGAmC8.js";import{L as g}from"./label-CUFgRLfr.js";import{S as R,a as V,b as D,c as P,d,T as G}from"./index-C4dMKRre.js";import{A as K}from"./app-layout-jSz2uPLn.js";import{C as U,a as W}from"./CustomtextArea-s-14ojIi.js";import{C as X}from"./Custommodal-Bijt5Y-c.js";import{u as Y}from"./useTranslation-DZairWB1.js";import{B as Z}from"./building-BQtN6JYq.js";import{P as ee}from"./package-C4hIybyN.js";import{T as se}from"./trash-2-CIaX_W2K.js";import{P as ae}from"./plus-B7cQxdFq.js";import{L as re}from"./loader-circle-DSYYfm_9.js";import{S as te}from"./save-DaJ3FWZK.js";/* empty css            */import"./index-C8Gpbpq8.js";import"./index-DDCA5pFv.js";import"./index-BDIKmkXC.js";import"./app-logo-icon-B5qPAw4t.js";import"./circle-check-big-DJ0PYvcw.js";function qe(){const{t:s}=Y(),[N,S]=q.useState(15),y=q.useRef(null),{errors:w}=Q().props,A=[{title:s("purchases"),href:"/purchases"},{title:s("create-purchase"),href:"/purchases/create"}],{data:r,setData:l,processing:I,errors:n,reset:E}=z({purchase_number:"",supplier_name:"",supplier_company:"",supplier_phone:"",supplier_email:"",supplier_address:"",items:[{id:"1",description:"",quantity:1,unit_price:0,total:0}],subtotal:0,vat_rate:15,vat:0,vat_amount:0,total:0,purchase_date:new Date().toISOString().split("T")[0],status:"pending",notes:""}),L=()=>{const a={id:Date.now().toString(),description:"",quantity:1,unit_price:0,total:0};l("items",[...r.items,a])},B=a=>{r.items.length>1&&l("items",r.items.filter(t=>t.id!==a))},_=(a,t,i)=>{const v=r.items.map(c=>{if(c.id===a){const p={...c,[t]:i};return(t==="quantity"||t==="unit_price")&&(p.total=p.quantity*p.unit_price),p}return c});l("items",v),T(v)},T=a=>{const t=a.reduce((c,p)=>c+p.total,0),i=t*N/100,v=t+i;l(c=>({...c,subtotal:t,vat:i,vat_amount:i,total:v,vat_rate:N}))},k=a=>{S(a),T(r.items)},J=a=>{a.preventDefault(),console.log("Form data before submit:",r),console.log("Items before JSON conversion:",r.items);const t={...r,items:JSON.stringify(r.items),vat_amount:r.vat||r.vat_amount||0};console.log("Submission data:",t),M.post(G("purchases.store"),t,{preserveScroll:!0,onSuccess:()=>{console.log("Purchase created successfully!"),y.current&&y.current.showModal(),E(),S(15)},onError:i=>{console.error("Validation errors:",i)}})},b=a=>new Intl.NumberFormat("ar-SA",{style:"currency",currency:"SAR"}).format(a);return e.jsxs(K,{breadcrumbs:A,children:[e.jsx(H,{title:s("create-purchase")}),e.jsxs("div",{className:"space-y-6 p-6",children:[(Object.keys(n).length>0||Object.keys(w||{}).length>0)&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-red-800 font-medium mb-2",children:"Validation Errors:"}),e.jsxs("ul",{className:"text-red-700 text-sm space-y-1",children:[Object.entries(n).map(([a,t])=>e.jsxs("li",{children:["• ",a,": ",t]},a)),Object.entries(w||{}).map(([a,t])=>e.jsxs("li",{children:["• ",a,": ",String(t)]},`page-${a}`))]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 arabic-font",children:s("create-purchase")}),e.jsx("p",{className:"text-gray-600 mt-1 arabic-font",children:s("create-purchase-description")})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(F,{href:"/purchases",children:e.jsx(m,{variant:"outline",className:"arabic-font",children:s("cancel")})})})]}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(O,{className:"h-5 w-5"}),s("purchase-information")]}),e.jsx(j,{className:"arabic-font",children:s("enter-basic-purchase-details")})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:s("purchase-number"),type:"text",placeholder:s("enter-purchase-number"),value:r.purchase_number,onChange:a=>l("purchase_number",a.target.value),error:n.purchase_number}),e.jsx(o,{label:s("purchase-date"),type:"date",value:r.purchase_date,onChange:a=>l("purchase_date",a.target.value),error:n.purchase_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"arabic-font",children:s("order-status")}),e.jsxs(R,{value:r.status,onValueChange:a=>l("status",a),children:[e.jsx(V,{children:e.jsx(D,{placeholder:s("select-purchase-status")})}),e.jsxs(P,{children:[e.jsx(d,{value:"pending",children:s("pending")}),e.jsx(d,{value:"completed",children:s("completed")}),e.jsx(d,{value:"cancelled",children:s("cancelled")})]})]}),n.status&&e.jsx("p",{className:"text-red-600 text-xs",children:n.status})]})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(Z,{className:"h-5 w-5"}),s("supplier-information")]}),e.jsx(j,{className:"arabic-font",children:s("enter-supplier-contact-details")})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:s("supplier-name"),type:"text",placeholder:s("enter-supplier-name"),value:r.supplier_name,onChange:a=>l("supplier_name",a.target.value),error:n.supplier_name}),e.jsx(o,{label:s("supplier-company"),type:"text",placeholder:s("enter-supplier-company"),value:r.supplier_company,onChange:a=>l("supplier_company",a.target.value),error:n.supplier_company})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:s("supplier-phone"),type:"text",placeholder:s("enter-supplier-phone"),value:r.supplier_phone,onChange:a=>l("supplier_phone",a.target.value),error:n.supplier_phone}),e.jsx(o,{label:s("supplier-email"),type:"email",placeholder:s("enter-supplier-email"),value:r.supplier_email,onChange:a=>l("supplier_email",a.target.value),error:n.supplier_email})]}),e.jsx(o,{label:s("supplier-address"),type:"text",placeholder:s("enter-supplier-address"),value:r.supplier_address,onChange:a=>l("supplier_address",a.target.value),error:n.supplier_address})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(ee,{className:"h-5 w-5"}),s("order-items")]}),e.jsx(j,{className:"arabic-font",children:s("add-items-to-purchase-order")})]}),e.jsxs(f,{className:"space-y-4",children:[r.items.map((a,t)=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium arabic-font",children:[s("item")," ",t+1]}),r.items.length>1&&e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>B(a.id),className:"text-red-600 hover:text-red-700 arabic-font",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),s("remove-item")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(g,{className:"arabic-font",children:s("item-description")}),e.jsx(C,{placeholder:s("enter-description"),value:a.description,onChange:i=>_(a.id,"description",i.target.value)})]}),e.jsxs("div",{children:[e.jsx(g,{className:"arabic-font",children:s("quantity")}),e.jsx(C,{type:"number",placeholder:s("enter-quantity"),value:a.quantity,onChange:i=>_(a.id,"quantity",parseInt(i.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(g,{className:"arabic-font",children:s("unit-price")}),e.jsx(C,{type:"number",step:"0.01",placeholder:s("enter-unit-price"),value:a.unit_price,onChange:i=>_(a.id,"unit_price",parseFloat(i.target.value)||0)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx(g,{className:"text-sm text-gray-600 arabic-font",children:s("item-total")}),e.jsx("div",{className:"text-lg font-semibold",children:b(a.total)})]})})]},a.id)),e.jsxs(m,{type:"button",variant:"outline",onClick:L,className:"w-full arabic-font",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),s("add-item")]})]})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(U,{className:"h-5 w-5"}),s("pricing-summary")]}),e.jsx(j,{className:"arabic-font",children:s("review-pricing-calculations")})]}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"arabic-font",children:s("purchase-subtotal")}),e.jsx("span",{className:"font-semibold",children:b(r.subtotal)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"arabic-font",children:s("vat-rate")}),e.jsxs(R,{value:N.toString(),onValueChange:a=>k(parseInt(a)),children:[e.jsx(V,{className:"w-24",children:e.jsx(D,{})}),e.jsxs(P,{children:[e.jsx(d,{value:"0",children:"0%"}),e.jsx(d,{value:"5",children:"5%"}),e.jsx(d,{value:"15",children:"15%"}),e.jsx(d,{value:"20",children:"20%"})]})]})]}),e.jsx("span",{className:"font-semibold",children:b(r.vat)})]}),e.jsx($,{}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{className:"arabic-font",children:s("final-total")}),e.jsx("span",{children:b(r.total)})]})]})})]}),e.jsxs(u,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center gap-2 arabic-font",children:[e.jsx(O,{className:"h-5 w-5"}),s("notes")]}),e.jsx(j,{className:"arabic-font",children:s("additional-purchase-notes")})]}),e.jsx(f,{children:e.jsx(W,{label:s("notes"),value:r.notes,onChange:a=>l("notes",a.target.value),error:n.notes})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6",children:[e.jsx(F,{href:"/purchases",children:e.jsx(m,{type:"button",variant:"outline",className:"arabic-font",children:s("cancel")})}),e.jsx(m,{type:"submit",disabled:I,className:"arabic-font",children:I?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),s("processing")]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),s("save-purchase")]})})]})]}),e.jsx(X,{modalname:y,message:s("purchase-added-successfully")})]})]})}export{qe as default};
